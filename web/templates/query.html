{% import "graphs.html" as graphs %}
{% from "query_extras.html" import query_line %}
{% from "query_extras.html" import query_checkbox %}
{% extends "layout.html" %}

{% block head %}
<script>
function addTerm(parentId) {
  var termDOM = {{ query_line() | tojson | safe }};
  var div = document.createElement('div');
  div.innerHTML = termDOM;
  console.log(div);
  document.getElementById(parentId).appendChild(div);
}
</script>
{% endblock head %}

{% block body %}
<form method="GET">
	<div class="row">
		<div class="col-lg-2">
      <h4>Options</h4>

      {{ query_checkbox("Cumulative", "cumulative") }}
      {{ query_checkbox("Log Scale", "log_scale") }}
      {{ query_checkbox("Month Granularity", "coarse") }}
      {{ query_checkbox("Split by Nick", "nick_split") }}

			<button class="btn btn btn-success btn-block"
              type="button"
              onclick="addTerm('term-container')">
				Add Term
      </button>

			<button class="btn btn btn-primary btn-block" type="submit">
				Graph
      </button>
		</div>

		<div id="term-container" class="col-lg-10">
      <div class="row">
        <div class="col-lg-2">
          <h4>Labels</h4>
        </div>
        <div class="col-lg-10">
          <h4>Regular Expressions</h4>
        </div>
      </div>

      {% if query == [] %}
        {{ query_line() }}
      {% else %}
      {% for (label, regexp) in query %}
        {{ query_line(label, regexp) }}
      {% endfor %}
      {% endif %}

		</div>
	</div>
</form>

<div class="page-header">
  <h3>Results</h3>
</div>

<div class="row">
  <div class="col-lg-12">
    {{ graphs.line_graph(
        'query-result',
        query,
        height='500px',
        coarse=request.args.get('coarse'),
        cumulative=request.args.get('cumulative'),
        log_scale=request.args.get('log_scale'),
        nick_split=request.args.get('nick_split'),
				zoom=True) }}
  </div>
</div>
{% endblock body %}
